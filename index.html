<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuron Budget</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo"><h1>Neuron Budget</h1></div>
            <nav class="nav">
                <a href="#" class="nav-link" id="authBtn" onclick="openAuthModal()">Вход</a>
                <a href="#operations" class="nav-link active">Операции</a>
                <a href="#analytics" class="nav-link">Аналитика</a>
                <a href="#budgets" class="nav-link">Бюджеты</a>
                <a href="#goals" class="nav-link">Цели</a>
            </nav>
        </header>

        <div class="quick-stats">
            <div class="stat-card">Баланс: <span id="currentBalance">0 ₽</span></div>
            <div class="stat-card">Доходы: <span id="totalIncome" class="income">0 ₽</span></div>
            <div class="stat-card">Расходы: <span id="totalExpense" class="expense">0 ₽</span></div>
        </div>

        <main class="main-content">
            <section id="operations" class="section active">
                <div class="section-header">
                    <h2>Операции</h2>
                    <button class="btn btn-primary" id="addBtn">+ Добавить</button>
                </div>
                <div id="transactionsContainer"></div>
            </section>
            
            <section id="analytics" class="section">
                <div class="analytics-grid">
                    <div class="chart-container"><canvas id="categoryChart"></canvas></div>
                    <div class="chart-container"><canvas id="trendChart"></canvas></div>
                </div>
            </section>

            <section id="budgets" class="section">
                <div class="section-header"><h2>Бюджеты</h2></div>
                <div class="budgets-grid" id="budgetsContainer"></div>
            </section>

            <section id="goals" class="section">
                <div class="section-header"><h2>Цели</h2></div>
                <div class="goals-grid" id="goalsContainer"></div>
            </section>
        </main>
    </div>

    <div id="authModal" class="modal">
        <div class="modal-content">
            <h3 id="authTitle">Вход</h3>
            <button class="btn btn-primary" id="googleLogin" style="width:100%; margin-bottom:10px;">Google</button>
            <form id="authForm">
                <input type="email" id="email" placeholder="Email" required style="width:100%; margin-bottom:10px; padding:8px;">
                <input type="password" id="password" placeholder="Пароль" required style="width:100%; margin-bottom:10px; padding:8px;">
                <button type="submit" class="btn btn-primary" style="width:100%">Ок</button>
            </form>
            <p onclick="toggleAuth()" style="cursor:pointer; text-align:center; margin-top:10px;" id="toggleText">Регистрация</p>
            <button onclick="closeModal('authModal')" class="btn btn-secondary">Закрыть</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDOaDVzzPjyYm4HWMND2XYWjLy_h4wty5s",
            authDomain: "neuron-ecosystem-2025.firebaseapp.com",
            projectId: "neuron-ecosystem-2025",
            storageBucket: "neuron-ecosystem-2025.firebasestorage.app",
            messagingSenderId: "589834476565",
            appId: "1:589834476565:web:26a110d25bb34e0add421c"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        window.db = getFirestore(app);

        window.openAuthModal = () => {
            if(auth.currentUser) { signOut(auth).then(() => location.reload()); }
            else { document.getElementById('authModal').classList.add('active'); }
        };

        onAuthStateChanged(auth, (user) => {
            window.currentUser = user;
            document.getElementById('authBtn').innerText = user ? "Выход (" + user.email.split('@')[0] + ")" : "Вход";
            if (window.budgetApp) window.budgetApp.loadInitialData();
        });

        // Логика Google и формы
        document.getElementById('googleLogin').onclick = () => signInWithPopup(auth, new GoogleAuthProvider());
        let isLogin = true;
        window.toggleAuth = () => {
            isLogin = !isLogin;
            document.getElementById('authTitle').innerText = isLogin ? "Вход" : "Регистрация";
            document.getElementById('toggleText').innerText = isLogin ? "Регистрация" : "Вход";
        };
        document.getElementById('authForm').onsubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            try {
                if(isLogin) await signInWithEmailAndPassword(auth, email, pass);
                else await createUserWithEmailAndPassword(auth, email, pass);
                document.getElementById('authModal').classList.remove('active');
            } catch(err) { alert(err.message); }
        };
    </script>
    <script src="script.js"></script>
</body>
</html>
