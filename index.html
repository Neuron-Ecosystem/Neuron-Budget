<!DOCTYPE html>
<html lang="ru">
<head>
    <meta name="google-site-verification" content="S4yj26laybYjHTBWA5u_2ey7dSgZ4F_5I22864VlCMU" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuron Budget - Управление финансами</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Дополнительные стили для Firebase модалки */
        .auth-toggle {
            text-align: center;
            margin-bottom: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            text-decoration: underline;
        }
        .google-btn {
            background: #fff;
            color: #757575;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .user-profile {
            display: none;
            align-items: center;
            gap: 10px;
            color: var(--secondary-color);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <h1>Neuron Budget</h1>
                <span>Ваш финансовый помощник</span>
            </div>
            <nav class="nav">
                <a href="#" class="nav-link" id="authBtn" onclick="showAuthModal()">Вход</a>
                <div id="userInfo" class="user-profile"></div>
                
                <a href="#operations" class="nav-link active">Операции</a>
                <a href="#analytics" class="nav-link">Аналитика</a>
                <a href="#budgets" class="nav-link">Бюджеты</a>
                <a href="#goals" class="nav-link">Цели</a>
            </nav>
        </header>

        <div class="quick-stats">
            <div class="stat-card">
                <span class="stat-label">Баланс</span>
                <span class="stat-value" id="currentBalance">0 ₽</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">Доходы</span>
                <span class="stat-value income" id="totalIncome">0 ₽</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">Расходы</span>
                <span class="stat-value expense" id="totalExpense">0 ₽</span>
            </div>
        </div>

        <main class="main-content">
            <section id="operations" class="section active">
                <div class="section-header">
                    <h2>Учет операций</h2>
                    <button class="btn btn-primary" onclick="addTransaction()">+ Добавить запись</button>
                </div>
                
                <div class="transaction-form">
                    <div class="form-group">
                        <label>Тип операции</label>
                        <div class="toggle-group">
                            <button class="toggle-btn active" data-type="income">Доход</button>
                            <button class="toggle-btn" data-type="expense">Расход</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="amount">Сумма</label>
                            <input type="number" id="amount" placeholder="0" min="0" step="0.01">
                        </div>
                        
                        <div class="form-group">
                            <label for="category">Категория</label>
                            <select id="category">
                                <option value="">Выберите категорию</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="description">Описание</label>
                        <input type="text" id="description" placeholder="Краткое описание операции">
                    </div>
                    
                    <div class="form-group">
                        <label for="date">Дата</label>
                        <input type="date" id="date">
                    </div>
                    
                    <button class="btn btn-primary btn-full" onclick="addTransaction()">Добавить запись</button>
                </div>

                <div class="transactions-list">
                    <h3>История операций</h3>
                    <div class="filters">
                        <select id="filterType" onchange="loadTransactions()">
                            <option value="all">Все операции</option>
                            <option value="income">Только доходы</option>
                            <option value="expense">Только расходы</option>
                        </select>
                        <select id="filterCategory" onchange="loadTransactions()">
                            <option value="all">Все категории</option>
                        </select>
                        <input type="month" id="filterMonth" onchange="loadTransactions()">
                    </div>
                    <div id="transactionsContainer" class="transactions-container"></div>
                </div>
            </section>

            <section id="analytics" class="section">
                <div class="section-header">
                    <h2>Аналитика и отчеты</h2>
                    <button class="btn btn-secondary" onclick="exportToCSV()">Экспорт в CSV</button>
                </div>
                
                <div class="analytics-grid">
                    <div class="chart-container">
                        <h3>Расходы по категориям</h3>
                        <canvas id="categoryChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Динамика за месяц</h3>
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <h4>Самые крупные расходы</h4>
                        <div id="topExpenses"></div>
                    </div>
                    <div class="stat-item">
                        <h4>Финансовая статистика</h4>
                        <div id="financialStats"></div>
                    </div>
                </div>
            </section>

            <section id="budgets" class="section">
                <div class="section-header">
                    <h2>Управление бюджетами</h2>
                    <button class="btn btn-primary" onclick="showAddBudgetModal()">+ Добавить бюджет</button>
                </div>
                
                <div class="budgets-grid" id="budgetsContainer"></div>
            </section>

            <section id="goals" class="section">
                <div class="section-header">
                    <h2>Цели накопления</h2>
                    <button class="btn btn-primary" onclick="showAddGoalModal()">+ Новая цель</button>
                </div>
                
                <div class="goals-grid" id="goalsContainer"></div>
            </section>
        </main>
    </div>

    <div id="authModal" class="modal">
        <div class="modal-content">
            <h3 id="authTitle">Вход в систему</h3>
            
            <button class="btn btn-full google-btn" id="googleLoginBtn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" alt="Google">
                Войти через Google
            </button>

            <div style="text-align: center; margin: 15px 0; color: var(--text-secondary);">или</div>

            <form id="authForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="authEmail" required>
                </div>
                <div class="form-group">
                    <label>Пароль</label>
                    <input type="password" id="authPassword" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full" id="authSubmitBtn">Войти</button>
            </form>
            
            <div class="auth-toggle" id="authToggle" onclick="toggleAuthMode()">Нет аккаунта? Зарегистрироваться</div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('authModal')">Закрыть</button>
            </div>
        </div>
    </div>

    <div id="addBudgetModal" class="modal">
        <div class="modal-content">
            <h3>Новый бюджет</h3>
            <form id="budgetForm">
                <div class="form-group">
                    <label>Категория</label>
                    <select id="budgetCategory" required></select>
                </div>
                <div class="form-group">
                    <label>Лимит бюджета</label>
                    <input type="number" id="budgetLimit" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Период</label>
                    <select id="budgetPeriod" required>
                        <option value="monthly">Ежемесячно</option>
                        <option value="weekly">Еженедельно</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addBudgetModal')">Отмена</button>
                    <button type="submit" class="btn btn-primary">Сохранить</button>
                </div>
            </form>
        </div>
    </div>

    <div id="addGoalModal" class="modal">
        <div class="modal-content">
            <h3>Новая цель</h3>
            <form id="goalForm">
                <div class="form-group">
                    <label>Название цели</label>
                    <input type="text" id="goalName" required placeholder="Например: Новый телефон">
                </div>
                <div class="form-group">
                    <label>Целевая сумма</label>
                    <input type="number" id="goalTarget" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Текущие накопления</label>
                    <input type="number" id="goalCurrent" value="0" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Срок цели</label>
                    <input type="date" id="goalDeadline" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addGoalModal')">Отмена</button>
                    <button type="submit" class="btn btn-primary">Сохранить</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { 
            getAuth, 
            signInWithPopup, 
            GoogleAuthProvider, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword,
            onAuthStateChanged,
            signOut 
        } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDOaDVzzPjyYm4HWMND2XYWjLy_h4wty5s",
            authDomain: "neuron-ecosystem-2025.firebaseapp.com",
            projectId: "neuron-ecosystem-2025",
            storageBucket: "neuron-ecosystem-2025.firebasestorage.app",
            messagingSenderId: "589834476565",
            appId: "1:589834476565:web:26a110d25bb34e0add421c",
            measurementId: "G-D832FXG8ET"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let isLoginMode = true;

        // Глобальные функции для работы с UI
        window.showAuthModal = () => {
            if (auth.currentUser) {
                signOut(auth).then(() => {
                    showNotification('Вы вышли из системы');
                });
            } else {
                document.getElementById('authModal').classList.add('active');
            }
        };

        window.toggleAuthMode = () => {
            isLoginMode = !isLoginMode;
            document.getElementById('authTitle').innerText = isLoginMode ? 'Вход в систему' : 'Регистрация';
            document.getElementById('authSubmitBtn').innerText = isLoginMode ? 'Войти' : 'Создать аккаунт';
            document.getElementById('authToggle').innerText = isLoginMode ? 'Нет аккаунта? Зарегистрироваться' : 'Уже есть аккаунт? Войти';
        };

        // Вход через Google
        document.getElementById('googleLoginBtn').addEventListener('click', async () => {
            try {
                await signInWithPopup(auth, provider);
                closeModal('authModal');
                showNotification('Успешный вход через Google!');
            } catch (error) {
                alert(error.message);
            }
        });

        // Вход/Регистрация через Email
        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;

            try {
                if (isLoginMode) {
                    await signInWithEmailAndPassword(auth, email, password);
                    showNotification('С возвращением!');
                } else {
                    await createUserWithEmailAndPassword(auth, email, password);
                    showNotification('Аккаунт создан!');
                }
                closeModal('authModal');
                document.getElementById('authForm').reset();
            } catch (error) {
                alert(error.message);
            }
        });

        // Слушатель состояния авторизации
        onAuthStateChanged(auth, (user) => {
            const authBtn = document.getElementById('authBtn');
            const userInfo = document.getElementById('userInfo');
            
            if (user) {
                authBtn.innerText = 'Выход';
                userInfo.style.display = 'flex';
                userInfo.innerText = user.displayName || user.email;
            } else {
                authBtn.innerText = 'Вход';
                userInfo.style.display = 'none';
            }
        });
    </script>

    <script src="script.js"></script>
</body>
</html>
